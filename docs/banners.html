<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uma Musume Banners</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 10px;
            font-size: 12px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 15px;
            color: #333;
            font-size: 1.5em;
        }

        .columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .column {
            background: white;
            border-radius: 6px;
            padding: 10px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        }

        .column h2 {
            text-align: center;
            margin-bottom: 10px;
            color: #444;
            font-size: 1.2em;
        }

        .banner-container {
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 8px;
            background: #fafafa;
        }

        .banner-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }

        .banner-image {
            max-width: 100%;
            margin-bottom: 8px;
            text-align: center;
        }

        .banner-image img {
            max-width: 100%;
            height: 60px;
            object-fit: contain;
            border-radius: 4px;
        }

        .pickup-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 5px;
            margin-bottom: 8px;
        }

        .pickup-item {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 4px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            min-height: 40px;
        }

        .pickup-image {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .pickup-details {
            flex-grow: 1;
            min-width: 0;
        }

        .pickup-id {
            font-weight: bold;
            color: #333;
            font-size: 10px;
        }

        .pickup-rate {
            color: #666;
            font-size: 9px;
        }

        .checkbox-container {
            flex-shrink: 0;
        }

        .banner-checkbox, .pickup-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .date-info {
            font-size: 9px;
            color: #666;
            text-align: center;
            margin-top: 3px;
        }

        .banner-controls {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }

        .control-btn {
            padding: 2px 6px;
            font-size: 10px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 3px;
            cursor: pointer;
        }

        .control-btn:hover {
            background: #f0f0f0;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        @media (max-width: 768px) {
            .columns {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .pickup-items {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Uma Musume Banners</h1>
        <div class="columns">
            <div class="column" id="characterBanners">
                <h2>Character Banners</h2>
                <div class="loading">Loading character banners...</div>
            </div>
            <div class="column" id="supportBanners">
                <h2>Support Banners</h2>
                <div class="loading">Loading support banners...</div>
            </div>
        </div>
    </div>

    <script>
        // Function to convert Unix timestamp to readable date
        function formatDate(timestamp) {
            return new Date(timestamp * 1000).toLocaleDateString();
        }

        // Function to generate image URL based on pickup ID
        function getImageUrl(pickupId) {
            const idStr = pickupId.toString();
            
            if (idStr.length === 6) {
                const firstFour = idStr.substring(0, 4);
                return `https://gametora.com/images/umamusume/characters/thumb/chara_stand_${firstFour}_${pickupId}.png`;
            } else if (idStr.length === 5) {
                return `https://gametora.com/images/umamusume/supports/tex_support_card_${pickupId}.png`;
            }
            
            return '';
        }

        // Function to create banner HTML
        function createBannerHTML(bannerData, type) {
            const bannerId = bannerData.id;
            const bannerImageUrl = `https://gametora.com/images/umamusume/en/gacha/img_bnr_gacha_${bannerId}.png`;
            const startDate = formatDate(bannerData.start);
            const endDate = formatDate(bannerData.end);

            let bannerHTML = `
                <div class="banner-container" data-banner-id="${bannerId}">
                    <div class="banner-header">
                        <strong>Banner ${bannerId}</strong>
                        <div class="checkbox-container">
                            <input type="checkbox" class="banner-checkbox" data-banner-id="${bannerId}" data-banner-type="${type}">
                        </div>
                    </div>
                    <div class="banner-image">
                        <img src="${bannerImageUrl}" alt="Banner ${bannerId}" onerror="this.style.display='none'">
                    </div>
                    <div class="pickup-items">
            `;

            // Add pickup items
            bannerData.pickups.forEach(pickup => {
                const [pickupId, rate, isPickup] = pickup;
                const imageUrl = getImageUrl(pickupId);
                const ratePercent = (rate / 100000 * 100).toFixed(3);

                bannerHTML += `
                    <div class="pickup-item">
                        <img src="${imageUrl}" alt="Pickup ${pickupId}" class="pickup-image" onerror="this.style.display='none'">
                        <div class="pickup-details">
                            <div class="pickup-id">${pickupId}</div>
                            <div class="pickup-rate">${ratePercent}%</div>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" class="pickup-checkbox" data-pickup-id="${pickupId}" data-banner-id="${bannerId}">
                        </div>
                    </div>
                `;
            });

            bannerHTML += `
                    </div>
                    <div class="date-info">
                        ${startDate} - ${endDate}
                    </div>
                    <div class="banner-controls">
                        <button class="control-btn select-all" data-banner-id="${bannerId}">Select All</button>
                        <button class="control-btn deselect-all" data-banner-id="${bannerId}">Deselect All</button>
                    </div>
                </div>
            `;

            return bannerHTML;
        }

        // Function to load JSON files
        async function loadJSON(filePath) {
            try {
                const response = await fetch(filePath);
                if (!response.ok) throw new Error(`Failed to load ${filePath}`);
                return await response.json();
            } catch (error) {
                console.error('Error loading JSON:', error);
                return null;
            }
        }

        // Function to initialize checkboxes and events
        function initializeCheckboxes() {
            // Banner checkbox controls all pickups in that banner
            document.querySelectorAll('.banner-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const bannerId = this.dataset.bannerId;
                    const pickupCheckboxes = document.querySelectorAll(`.pickup-checkbox[data-banner-id="${bannerId}"]`);
                    pickupCheckboxes.forEach(pickupCb => {
                        pickupCb.checked = this.checked;
                    });
                    saveSelections();
                });
            });

            // Individual pickup checkboxes
            document.querySelectorAll('.pickup-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', saveSelections);
            });

            // Control buttons
            document.querySelectorAll('.select-all').forEach(btn => {
                btn.addEventListener('click', function() {
                    const bannerId = this.dataset.bannerId;
                    const checkboxes = document.querySelectorAll(`.pickup-checkbox[data-banner-id="${bannerId}"]`);
                    checkboxes.forEach(cb => cb.checked = true);
                    document.querySelector(`.banner-checkbox[data-banner-id="${bannerId}"]`).checked = true;
                    saveSelections();
                });
            });

            document.querySelectorAll('.deselect-all').forEach(btn => {
                btn.addEventListener('click', function() {
                    const bannerId = this.dataset.bannerId;
                    const checkboxes = document.querySelectorAll(`.pickup-checkbox[data-banner-id="${bannerId}"]`);
                    checkboxes.forEach(cb => cb.checked = false);
                    document.querySelector(`.banner-checkbox[data-banner-id="${bannerId}"]`).checked = false;
                    saveSelections();
                });
            });

            loadSelections();
        }

        // Save selections to localStorage
        function saveSelections() {
            const selections = {};
            document.querySelectorAll('.pickup-checkbox:checked').forEach(checkbox => {
                const bannerId = checkbox.dataset.bannerId;
                const pickupId = checkbox.dataset.pickupId;
                if (!selections[bannerId]) selections[bannerId] = [];
                selections[bannerId].push(pickupId);
            });
            localStorage.setItem('bannerSelections', JSON.stringify(selections));
        }

        // Load selections from localStorage
        function loadSelections() {
            const saved = localStorage.getItem('bannerSelections');
            if (saved) {
                const selections = JSON.parse(saved);
                Object.keys(selections).forEach(bannerId => {
                    selections[bannerId].forEach(pickupId => {
                        const checkbox = document.querySelector(`.pickup-checkbox[data-banner-id="${bannerId}"][data-pickup-id="${pickupId}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                    
                    // Update banner checkbox state
                    const bannerCheckbox = document.querySelector(`.banner-checkbox[data-banner-id="${bannerId}"]`);
                    if (bannerCheckbox) {
                        const allPickups = document.querySelectorAll(`.pickup-checkbox[data-banner-id="${bannerId}"]`);
                        const checkedPickups = document.querySelectorAll(`.pickup-checkbox[data-banner-id="${bannerId}"]:checked`);
                        bannerCheckbox.checked = allPickups.length === checkedPickups.length && allPickups.length > 0;
                    }
                });
            }
        }

        // Main initialization function
        async function initializePage() {
            const characterBanners = document.getElementById('characterBanners');
            const supportBanners = document.getElementById('supportBanners');

            try {
                // Load both JSON files
                const [charData, supportData] = await Promise.all([
                    loadJSON('docs/data/char-standard.30dbddac.json'),
                    loadJSON('docs/data/support-standard.8b227fc8.json')
                ]);

                // Clear loading messages
                characterBanners.innerHTML = '<h2>Character Banners</h2>';
                supportBanners.innerHTML = '<h2>Support Banners</h2>';

                // Process character banners
                if (charData && Array.isArray(charData)) {
                    charData.forEach(banner => {
                        characterBanners.innerHTML += createBannerHTML(banner, 'character');
                    });
                } else if (charData) {
                    // Handle single banner object
                    characterBanners.innerHTML += createBannerHTML(charData, 'character');
                }

                // Process support banners
                if (supportData && Array.isArray(supportData)) {
                    supportData.forEach(banner => {
                        supportBanners.innerHTML += createBannerHTML(banner, 'support');
                    });
                } else if (supportData) {
                    // Handle single banner object
                    supportBanners.innerHTML += createBannerHTML(supportData, 'support');
                }

                // Initialize checkbox functionality
                initializeCheckboxes();

            } catch (error) {
                console.error('Error initializing page:', error);
                characterBanners.innerHTML = '<h2>Character Banners</h2><div class="loading">Error loading data</div>';
                supportBanners.innerHTML = '<h2>Support Banners</h2><div class="loading">Error loading data</div>';
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>